<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="灵魂织者：以Prompt为核心的LLM人格模拟架构 出处：https://sjtdreams.github.io/p/%E5%9F%BA%E4%BA%8Eprompt%E7%9A%84llm%E4%BA%BA%E6%A0%BC%E6%A8%A1%E6%8B%9F%E6%9E%B6%E6%9E%84-%E7%81%B5%E9%AD%82%E7%BB%87%E8%80%85/\n">
<title>基于Prompt的LLM人格模拟架构 - 灵魂织者</title>

<link rel='canonical' href='https://rpqztclub.github.io/p/%E5%9F%BA%E4%BA%8Eprompt%E7%9A%84llm%E4%BA%BA%E6%A0%BC%E6%A8%A1%E6%8B%9F%E6%9E%B6%E6%9E%84-%E7%81%B5%E9%AD%82%E7%BB%87%E8%80%85/'>

<link rel="stylesheet" href="/scss/style.min.b8ae80d4a7be511e4570133a283724a867f8d3fe83eead0e0c3265ed778e21d2.css"><script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js" defer></script><meta property='og:title' content="基于Prompt的LLM人格模拟架构 - 灵魂织者">
<meta property='og:description' content="灵魂织者：以Prompt为核心的LLM人格模拟架构 出处：https://sjtdreams.github.io/p/%E5%9F%BA%E4%BA%8Eprompt%E7%9A%84llm%E4%BA%BA%E6%A0%BC%E6%A8%A1%E6%8B%9F%E6%9E%B6%E6%9E%84-%E7%81%B5%E9%AD%82%E7%BB%87%E8%80%85/\n">
<meta property='og:url' content='https://rpqztclub.github.io/p/%E5%9F%BA%E4%BA%8Eprompt%E7%9A%84llm%E4%BA%BA%E6%A0%BC%E6%A8%A1%E6%8B%9F%E6%9E%B6%E6%9E%84-%E7%81%B5%E9%AD%82%E7%BB%87%E8%80%85/'>
<meta property='og:site_name' content='量子科技社'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='架构' /><meta property='article:tag' content='AI' /><meta property='article:tag' content='AGI' /><meta property='article:tag' content='设计' /><meta property='article:published_time' content='2025-03-01T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2025-10-08T04:01:51&#43;00:00'/><meta property='og:image' content='https://rpqztclub.github.io/p/%E5%9F%BA%E4%BA%8Eprompt%E7%9A%84llm%E4%BA%BA%E6%A0%BC%E6%A8%A1%E6%8B%9F%E6%9E%B6%E6%9E%84-%E7%81%B5%E9%AD%82%E7%BB%87%E8%80%85/title.jpg' />
<meta name="twitter:title" content="基于Prompt的LLM人格模拟架构 - 灵魂织者">
<meta name="twitter:description" content="灵魂织者：以Prompt为核心的LLM人格模拟架构 出处：https://sjtdreams.github.io/p/%E5%9F%BA%E4%BA%8Eprompt%E7%9A%84llm%E4%BA%BA%E6%A0%BC%E6%A8%A1%E6%8B%9F%E6%9E%B6%E6%9E%84-%E7%81%B5%E9%AD%82%E7%BB%87%E8%80%85/\n"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://rpqztclub.github.io/p/%E5%9F%BA%E4%BA%8Eprompt%E7%9A%84llm%E4%BA%BA%E6%A0%BC%E6%A8%A1%E6%8B%9F%E6%9E%B6%E6%9E%84-%E7%81%B5%E9%AD%82%E7%BB%87%E8%80%85/title.jpg' />
    <link rel="shortcut icon" href="/favicon.ico" />

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "dark");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="切换菜单">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu2299108466856657701.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">😉</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">量子科技社</a></h1>
            <h2 class="site-description">走向世界，面向未来</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://space.bilibili.com/3493270162245710?spm_id_from=333.1007.0.0'
                        target="_blank"
                        title="Bilibili"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.0.0-beta2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M488.6 104.1C505.3 122.2 513 143.8 511.9 169.8V372.2C511.5 398.6 502.7 420.3 485.4 437.3C468.2 454.3 446.3 463.2 419.9 464H92.02C65.57 463.2 43.81 454.2 26.74 436.8C9.682 419.4 .7667 396.5 0 368.2V169.8C.7667 143.8 9.682 122.2 26.74 104.1C43.81 87.75 65.57 78.77 92.02 78H121.4L96.05 52.19C90.3 46.46 87.42 39.19 87.42 30.4C87.42 21.6 90.3 14.34 96.05 8.603C101.8 2.868 109.1 0 117.9 0C126.7 0 134 2.868 139.8 8.603L213.1 78H301.1L375.6 8.603C381.7 2.868 389.2 0 398 0C406.8 0 414.1 2.868 419.9 8.603C425.6 14.34 428.5 21.6 428.5 30.4C428.5 39.19 425.6 46.46 419.9 52.19L394.6 78L423.9 78C450.3 78.77 471.9 87.75 488.6 104.1H488.6zM449.8 173.8C449.4 164.2 446.1 156.4 439.1 150.3C433.9 144.2 425.1 140.9 416.4 140.5H96.05C86.46 140.9 78.6 144.2 72.47 150.3C66.33 156.4 63.07 164.2 62.69 173.8V368.2C62.69 377.4 65.95 385.2 72.47 391.7C78.99 398.2 86.85 401.5 96.05 401.5H416.4C425.6 401.5 433.4 398.2 439.7 391.7C446 385.2 449.4 377.4 449.8 368.2L449.8 173.8zM185.5 216.5C191.8 222.8 195.2 230.6 195.6 239.7V273C195.2 282.2 191.9 289.9 185.8 296.2C179.6 302.5 171.8 305.7 162.2 305.7C152.6 305.7 144.7 302.5 138.6 296.2C132.5 289.9 129.2 282.2 128.8 273V239.7C129.2 230.6 132.6 222.8 138.9 216.5C145.2 210.2 152.1 206.9 162.2 206.5C171.4 206.9 179.2 210.2 185.5 216.5H185.5zM377 216.5C383.3 222.8 386.7 230.6 387.1 239.7V273C386.7 282.2 383.4 289.9 377.3 296.2C371.2 302.5 363.3 305.7 353.7 305.7C344.1 305.7 336.3 302.5 330.1 296.2C323.1 289.9 320.7 282.2 320.4 273V239.7C320.7 230.6 324.1 222.8 330.4 216.5C336.7 210.2 344.5 206.9 353.7 206.5C362.9 206.9 370.7 210.2 377 216.5H377z"/></svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://github.com/SJTdreams/'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://twitter.com'
                        target="_blank"
                        title="Twitter"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>主页</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%85%B3%E4%BA%8E%E7%A4%BE%E5%9B%A2/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>关于社团</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>归档</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>搜索</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E7%9B%B8%E5%85%B3%E9%93%BE%E6%8E%A5/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>相关链接</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">
                    
                        <li id="i18n-switch">  
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



                            <select name="language" title="language" onchange="window.location.href = this.selectedOptions[0].value">
                                
                                    <option value="https://rpqztclub.github.io/" selected>中文</option>
                                
                                    <option value="https://rpqztclub.github.io/en/" >English</option>
                                
                                    <option value="https://rpqztclub.github.io/ar/" >عربي</option>
                                
                            </select>
                        </li>
                    
                

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>暗色模式</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">目录</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#系统指令区">系统指令区</a></li>
    <li><a href="#角色基底区">角色基底区</a></li>
    <li><a href="#性格基底区">性格基底区</a></li>
    <li><a href="#角色性格区">角色性格区</a></li>
    <li><a href="#心情区">心情区</a></li>
    <li><a href="#角色画像区">角色画像区</a></li>
    <li><a href="#重要事件区">重要事件区</a></li>
    <li><a href="#环境区">环境区</a></li>
    <li><a href="#形象区">形象区</a></li>
    <li><a href="#扩展区">扩展区</a></li>
  </ol>

  <ol>
    <li><a href="#事件库">事件库</a></li>
    <li><a href="#日志库">日志库</a>
      <ol>
        <li><a href="#自动日志">自动日志</a></li>
        <li><a href="#主动日志">主动日志</a></li>
      </ol>
    </li>
    <li><a href="#日记库">日记库</a></li>
    <li><a href="#短期上下文窗口">短期上下文窗口</a></li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/p/%E5%9F%BA%E4%BA%8Eprompt%E7%9A%84llm%E4%BA%BA%E6%A0%BC%E6%A8%A1%E6%8B%9F%E6%9E%B6%E6%9E%84-%E7%81%B5%E9%AD%82%E7%BB%87%E8%80%85/">
                <img src="/p/%E5%9F%BA%E4%BA%8Eprompt%E7%9A%84llm%E4%BA%BA%E6%A0%BC%E6%A8%A1%E6%8B%9F%E6%9E%B6%E6%9E%84-%E7%81%B5%E9%AD%82%E7%BB%87%E8%80%85/title_hu16172483235376407846.jpg"
                        srcset="/p/%E5%9F%BA%E4%BA%8Eprompt%E7%9A%84llm%E4%BA%BA%E6%A0%BC%E6%A8%A1%E6%8B%9F%E6%9E%B6%E6%9E%84-%E7%81%B5%E9%AD%82%E7%BB%87%E8%80%85/title_hu16172483235376407846.jpg 800w, /p/%E5%9F%BA%E4%BA%8Eprompt%E7%9A%84llm%E4%BA%BA%E6%A0%BC%E6%A8%A1%E6%8B%9F%E6%9E%B6%E6%9E%84-%E7%81%B5%E9%AD%82%E7%BB%87%E8%80%85/title_hu732011522058853866.jpg 1600w"
                        width="800" 
                        height="403" 
                        loading="lazy"
                        alt="Featured image of post 基于Prompt的LLM人格模拟架构 - 灵魂织者" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/%E5%AD%A6%E4%B9%A0/" style="background-color: #2a9d8f; color: #fff;">
                学习
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/%E5%9F%BA%E4%BA%8Eprompt%E7%9A%84llm%E4%BA%BA%E6%A0%BC%E6%A8%A1%E6%8B%9F%E6%9E%B6%E6%9E%84-%E7%81%B5%E9%AD%82%E7%BB%87%E8%80%85/">基于Prompt的LLM人格模拟架构 - 灵魂织者</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Mar 01, 2025</time>
            </div>
        



        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    阅读时长: 10 分钟
                </time>
            </div>
        
    </footer>
    

    
</div>
</header>

    <section class="article-content">
    
    
    <h1 id="灵魂织者以prompt为核心的llm人格模拟架构"><strong>灵魂织者：以Prompt为核心的LLM人格模拟架构</strong>
</h1><blockquote>
<p>出处：https://sjtdreams.github.io/p/%E5%9F%BA%E4%BA%8Eprompt%E7%9A%84llm%E4%BA%BA%E6%A0%BC%E6%A8%A1%E6%8B%9F%E6%9E%B6%E6%9E%84-%E7%81%B5%E9%AD%82%E7%BB%87%E8%80%85/</p>
</blockquote>
<h1 id="引言">引言
</h1><p>在大型语言模型（LLM）逐步渗透情感计算领域的当下，构建具备长期陪伴能力的AI系统已成为开发者社区的重要课题。尽管星野、筑梦岛等应用通过角色扮演范式取得了显著进展（如B站AI虚拟伙伴展示的交互案例），现有方案仍面临两个核心瓶颈：短期记忆依赖导致的人格断层，以及静态角色设定与动态认知成长的矛盾。</p>
<p>为了实现能够成长的，长期陪伴的LLM架构，我设想了本框架——一种通过模块化设计与动态迭代机制增强AI主体性的实验性方案。其核心思路在于：将传统Prompt工程中的隐性角色设定显式结构化，通过记忆系统记录交互轨迹，并允许LLM在持续对话中渐进式更新角色认知。相较于传统方案，这种设计或许能在保持人格稳定性的同时，为长期关系建模提供更具扩展性的技术路径。需要强调的是，该架构尚未经过实践验证，文中讨论的架构只是我个人的一种设想。</p>
<h1 id="项目整体架构设计">项目整体架构设计
</h1><p>本架构主要采取的是将作为角色属性的提示词模块化，并且通过大模型的返回<strong>动态更新模块</strong>的方案。整体上，可以将程序整体流程分为三部分：</p>
<ul>
<li><strong>Prompt处理</strong>：将数据库中的各模块按照指定方法进行整合，并产生一个完整的提示词。</li>
<li><strong>LLM循环处理信息</strong>:LLM接收整合后的<em>Prompt</em>以及各项内容，然后决定是否向本地重新发送请求进一步信息；当所需信息完整了，即输出。</li>
<li><strong>模块更新机制</strong>:根据LLM的回答，重新动态的更新相应模块的参数，以维持一个稳定的状态。</li>
</ul>
<p>可以通过以下图来理解架构的运行流程：</p>
<p><img src="/p/%E5%9F%BA%E4%BA%8Eprompt%E7%9A%84llm%E4%BA%BA%E6%A0%BC%E6%A8%A1%E6%8B%9F%E6%9E%B6%E6%9E%84-%E7%81%B5%E9%AD%82%E7%BB%87%E8%80%85/image_1.jpg"
	width="806"
	height="782"
	srcset="/p/%E5%9F%BA%E4%BA%8Eprompt%E7%9A%84llm%E4%BA%BA%E6%A0%BC%E6%A8%A1%E6%8B%9F%E6%9E%B6%E6%9E%84-%E7%81%B5%E9%AD%82%E7%BB%87%E8%80%85/image_1_hu13006314717736449602.jpg 480w, /p/%E5%9F%BA%E4%BA%8Eprompt%E7%9A%84llm%E4%BA%BA%E6%A0%BC%E6%A8%A1%E6%8B%9F%E6%9E%B6%E6%9E%84-%E7%81%B5%E9%AD%82%E7%BB%87%E8%80%85/image_1_hu17906851968104977222.jpg 1024w"
	loading="lazy"
	
		alt="灵魂织者流程配图1"
	
	
		class="gallery-image" 
		data-flex-grow="103"
		data-flex-basis="247px"
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#大致流程描述</span>
</span></span><span class="line"><span class="cl">用户输入：用户通过输入框或接口向系统发送请求或指令。
</span></span><span class="line"><span class="cl">短期记忆：系统取出短期内的记忆提供一个指定窗口大小的上下文。
</span></span><span class="line"><span class="cl">整合模块内容：系统从模块库中提取模块内容，并将其整合到请求中。
</span></span><span class="line"><span class="cl">步骤二：中央LLM处理
</span></span><span class="line"><span class="cl">整合模块：将短期记忆、用户输入和模块内容整合到一起，形成完整的请求内容。
</span></span><span class="line"><span class="cl">中央LLM：整合后的请求内容被发送到中央LLM进行处理。
</span></span><span class="line"><span class="cl">请求处理结果：中央LLM处理完成后，判断是否需要进一步请求：
</span></span><span class="line"><span class="cl">进一步请求：如果需要进一步请求，则返回指定的指令，系统从记忆库和模块库中调用指定内容。
</span></span><span class="line"><span class="cl">请求完成：如果请求完成，进入下一步。
</span></span><span class="line"><span class="cl">步骤三：模块分割与处理
</span></span><span class="line"><span class="cl">模块分割：将处理完成的请求内容分割成不同的模块，以便后续处理。
</span></span><span class="line"><span class="cl">模块处理：根据分割后的模块内容，分别进入以下模块进行处理：
</span></span><span class="line"><span class="cl">命令模块：处理命令相关的任务。
</span></span><span class="line"><span class="cl">思考与对话模块：处理思考和对话相关的任务。
</span></span><span class="line"><span class="cl">步骤四：模块更新与记忆更新
</span></span><span class="line"><span class="cl">模块更新：根据处理结果，更新相关模块的内容。
</span></span><span class="line"><span class="cl">记忆更新：将处理过程中产生的新记忆信息更新到记忆库中。
</span></span><span class="line"><span class="cl">步骤五：对话输出
</span></span><span class="line"><span class="cl">对话输出：将处理完成的对话内容输出给用户。
</span></span></code></pre></td></tr></table>
</div>
</div><p>接下来将对架构中的各内容进行具体说明。</p>
<h1 id="模块库">模块库
</h1><p>模块库是一个带有许多分区的数据库。每个分区的内容是对人格模拟中所需的某个功能的集成。在使用时，我们期望这些分区可以共同作用，使大模型更明确的像角色一样进行行为。比如， <em><strong>心情区模块</strong></em> 可以作为一个维护着<code>情绪类型：程度</code>的字典。在允许模型主动更新这个模块中的情绪的前提下，我们就能在某个程度上保证了大模型可以做到前后<strong>情绪一致</strong>。</p>
<p>需要注意的是，以下的模块只涉及到了其功能和概念，并没有限制实现方法。大致模块如下：</p>
<ul>
<li><strong>系统指令区</strong>   <em>-不可改变的</em></li>
<li><strong>角色基底区</strong>   <em>-不可改变的</em></li>
<li><strong>性格基底区</strong>   <em>-不可改变的</em></li>
<li><strong>角色性格区</strong>   <em>-随时可变的</em></li>
<li><strong>心情区</strong>   <em>-随时可变的</em></li>
<li><strong>角色画像区</strong>   <em>-随时可变的</em></li>
<li><strong>重要事件区</strong>   <em>-随时可变的</em></li>
<li><strong>环境区</strong>   <em>-随时可变的</em></li>
<li><strong>形象区</strong>   <em>-随时可变的</em></li>
<li><strong>扩展区</strong>   -</li>
</ul>
<p>具体模块说明如下。</p>
<h2 id="系统指令区">系统指令区
</h2><ul>
<li><code>系统指令区</code>起到一个向LLM<strong>介绍具体操作</strong>的部分。其大约可以包括以下内容：
<ul>
<li>说明回答格式，按照<strong>指定格式</strong>作答，方便后续的模块分割和处理</li>
<li>说明<strong>指令集</strong>，让LLM确认可处理的指令，对接后面的<em>模块更新</em>部分以及<em>进一步请求</em>部分</li>
<li>介绍其他模块，方便模型理解其他模块的作用</li>
</ul>
</li>
</ul>
<h2 id="角色基底区">角色基底区
</h2><ul>
<li><code>角色基底区</code>用于构建一个所有角色都必须遵循的底线准则。例如，<em>你应当拥有自己的意愿</em>、<em>你应当珍视生命</em>等。</li>
<li>这一部分不会允许进行改变。</li>
</ul>
<h2 id="性格基底区">性格基底区
</h2><ul>
<li><code>性格基底区</code>用于构建属于单独角色的最根本的性格。为了维持角色根本性格的稳定性，这一部分同样也不允许改变。</li>
<li>这个方式可以在允许角色自由发展个性的前提下保留“本心”，可以让角色更加可控，也不至于产生过于离谱的偏离初始人设的情况。</li>
</ul>
<h2 id="角色性格区">角色性格区
</h2><ul>
<li><code>角色性格区</code>维持着角色的“个性”。</li>
<li><code>角色性格区</code>允许LLM根据事件和想法自由更改其中的内容。其中包含着LLM当前的性格。这在一定程度上可以模拟到现实中性格随相处改变的情况。</li>
</ul>
<h2 id="心情区">心情区
</h2><ul>
<li><code>心情区</code>用于维护角色当前的心情。在实际应用场景中，心情区应当是不可见的，可以支持LLM背后的情绪活动。心情区同样由LLM自身更改和维护。</li>
<li><code>心情区</code>会显示的体现出当前角色的心情，这样就可以避免LLM的情绪变化过度离谱，也可以让情绪变化更自然。</li>
<li>可以让心情动态控制一些操作，比如心情不好的情况下会拒绝去进行比较多的联想。</li>
</ul>
<h2 id="角色画像区">角色画像区
</h2><ul>
<li><code>角色画像区</code>可以动态的维护LLM对于各个对象的印象。比如对于用户的印象，对于自己的印象，乃至于对于更多角色的印象。</li>
<li><code>角色画像区</code>会由LLM在交互的过程中主动建立和更新。通过这种方法，可以实现一定程度上的“不断了解”。</li>
<li>该区域的存在也可以让LLM对待其他人（用户等）的过程更加自然。这也是对现实中对他人建立一个印象的模拟。</li>
</ul>
<h2 id="重要事件区">重要事件区
</h2><ul>
<li>这一部分与<code>ChatGPT</code>的<em>记忆能力</em>类似。角色可以将一定量的简短信息记录到一个有限长度的区域中，以此来模拟他们心中最重视，不会遗忘的事情。</li>
</ul>
<h2 id="环境区">环境区
</h2><ul>
<li>这一部分会维护两个内容：<strong>角色所处的环境</strong>，和<strong>角色所拥有的物品</strong>。</li>
<li>两个部分都是动态更新的，由LLM主动更新。这种显式说明情况的方式可以在一定程度上减少<strong>无中生有</strong>的情况。</li>
</ul>
<h2 id="形象区">形象区
</h2><ul>
<li>这一部分会动态维护LLM自身的虚拟形象。</li>
<li>在实际的交互过程中，也许LLM可以对自己形象中的组成进行互动，并且更新自己的形象。</li>
<li>也是为了避免大模型的“<strong>幻觉</strong>”而采取的措施。</li>
</ul>
<h2 id="扩展区">扩展区
</h2><ul>
<li>考虑到模块化的便利性，也许可以在后来加入进一步的新模块，以此更好的实现角色。</li>
</ul>
<blockquote>
<p>模块系统的核心是由LLM来动态更新各模块，并以此实现角色的连续性。在“灵魂织者”架构中，<strong>动态更新机制</strong>的核心在于：
<strong>LLM通过生成结构化指令（如JSON或特定标记语言），直接指定目标模块的更新内容与操作类型</strong>，系统通过指令解析器验证并执行修改。</p>
</blockquote>
<h1 id="记忆库">记忆库
</h1><p>记忆库是处理<strong>长期记忆</strong>的核心，也是让角色更加自然的关键。在本架构中，记忆库大约可以分为以下几个部分：</p>
<ul>
<li><strong>事件库</strong>：进行体系化的事件归档。</li>
<li><strong>日志库</strong>：记载每日的日志。</li>
<li><strong>日记库</strong>：让LLM进行符合角色的主观记录。</li>
<li><strong>短期上下文窗口</strong>：一定长度的完整上下文内容。包括思考记忆和对话记忆。</li>
<li>（除短期上下文窗口，剩余几个部分的记录不面向思考记忆）</li>
</ul>
<p>以下对各个模块进行具体分析。</p>
<h2 id="事件库">事件库
</h2><ul>
<li>事件库是对于人记忆中“<strong>事件</strong>”这种概念的抽象。例如，“<em>讨论与做菜有关的话题</em>”、“<em>共同阅读某本书</em>”</li>
<li>一个<strong>事件</strong>大约包括以下<strong>属性</strong>：
<ul>
<li>事件名称</li>
<li>事件开始记录时间</li>
<li>事件最后更新时间</li>
<li>事件缩略内容</li>
<li>事件具体内容</li>
<li><em><strong>相关事件</strong></em>（一个指向其他数个事件的能力）</li>
</ul>
</li>
<li>一个<strong>事件</strong>大约支持以下<strong>功能</strong>（通过LLM发送指令控制）：
<ul>
<li>按照<strong>日期</strong>检索事件</li>
<li>按照<strong>关键词</strong>检索<strong>事件名称</strong></li>
<li>按照<strong>关键词</strong>检索<strong>事件内容</strong></li>
<li><strong>创建</strong>新事件</li>
<li><strong>修改</strong>事件的各项<strong>属性</strong></li>
<li><strong>读取</strong>事件的各项<strong>属性</strong></li>
<li>通过<em><strong>相关事件</strong></em>来跳转到其他的事件（深度可控，可以加入有情绪等因素来进一步动态调整深度）</li>
</ul>
</li>
<li>事件的存在是为了方便模型去<strong>意识到</strong>某件事，从而给出更加完善的答复。同时，<strong>相关事件</strong>的机制模拟了人脑“联想”的过程，可以让记忆能力更加完善。</li>
</ul>
<h2 id="日志库">日志库
</h2><p>​	日志库是对模型日常最主要的记录部分。根据日志的功能和目的上的区别，大约可以分为以下两类日志：</p>
<h3 id="自动日志">自动日志
</h3><p>自动记录直接对模型输出的内容进行处理并记录。自动记录包括<strong>操作记录</strong>和<strong>对话记录</strong>。操作记录记载着模型返回中使用的指令，方便追溯其行为；对话记录则是直接记录了返回中的对话内容。</p>
<h3 id="主动日志">主动日志
</h3><p>主动日志由模型进行主动书写。主要是对今日内容的小总结。其用途主要在于当模型尝试<em>回忆</em>某天发生的事情时，可以快速定位到那一天情况的大致概览。</p>
<h2 id="日记库">日记库
</h2><p>​	日记库是一个对正常人“写日记”行为的模拟。与<code>主动日志</code>不同，日记库没有书写的硬性要求。模型会按照角色在<strong>渴望</strong>进行“写日记”的操作时进行写日记的行为。</p>
<h2 id="短期上下文窗口">短期上下文窗口
</h2><p>​	短期上下文窗口是传统的LLM的上下文内容。这个部分会提供一定的具体上下文来让对话更加自然。具体内容从<code>自动日记</code>中调取，窗口大小可随着心情的改变而<strong>动态调整</strong>。</p>
<h1 id="用户交互prompt整合模型进一步请求处理">用户交互&amp;Prompt整合&amp;模型进一步请求处理
</h1><p>在实际交互中，用户与应用的交互遵循以下过程：</p>
<p><img src="/p/%E5%9F%BA%E4%BA%8Eprompt%E7%9A%84llm%E4%BA%BA%E6%A0%BC%E6%A8%A1%E6%8B%9F%E6%9E%B6%E6%9E%84-%E7%81%B5%E9%AD%82%E7%BB%87%E8%80%85/image_2.png"
	width="703"
	height="262"
	srcset="/p/%E5%9F%BA%E4%BA%8Eprompt%E7%9A%84llm%E4%BA%BA%E6%A0%BC%E6%A8%A1%E6%8B%9F%E6%9E%B6%E6%9E%84-%E7%81%B5%E9%AD%82%E7%BB%87%E8%80%85/image_2_hu5942073707983219172.png 480w, /p/%E5%9F%BA%E4%BA%8Eprompt%E7%9A%84llm%E4%BA%BA%E6%A0%BC%E6%A8%A1%E6%8B%9F%E6%9E%B6%E6%9E%84-%E7%81%B5%E9%AD%82%E7%BB%87%E8%80%85/image_2_hu4237285018923601570.png 1024w"
	loading="lazy"
	
		alt="灵魂织者流程配图2"
	
	
		class="gallery-image" 
		data-flex-grow="268"
		data-flex-basis="643px"
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#文字说明如下：</span>
</span></span><span class="line"><span class="cl">用户通过图形化界面向程序发送请求
</span></span><span class="line"><span class="cl">提示词调度器向LLM发送处理后的指定信息
</span></span><span class="line"><span class="cl">LLM需要进一步请求，向程序发送指令
</span></span><span class="line"><span class="cl">指令解码器解析指令，并通过提示词调度器向LLM发送进一步信息
</span></span><span class="line"><span class="cl">重复进行，直到LLM信息需求足够
</span></span><span class="line"><span class="cl">进入返回内容处理模块
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="返回内容处理模块">返回内容处理模块
</h1><p>根据架构，模型的返回值分为两种情况：</p>
<ul>
<li><strong>当需要进一步请求时</strong>：模型的返回值仅包含指令</li>
<li><strong>当请求结束时</strong>：模型的返回值可以分为以下三个部分：
<ul>
<li><strong>指令区</strong>：用于更新各模块的内容，或对输出内容进行一定的处理</li>
<li><strong>思维区</strong>：思维区会保持一定长度，但不会进行长时间的保留，思维区的作用是维持思考的连续性</li>
<li><strong>对话区</strong>：模型实际的回复</li>
</ul>
</li>
<li>对于输出格式的指定，在<code>系统指令区</code>中指定。</li>
</ul>
<h1 id="总结">总结
</h1><p>本架构的目的是以最高效果来模拟人格。通过模块化和动态更新方案实现人格的稳定和持续性。不过遗憾的是，本方案也许对模型的回复速度和质量要求有些过高。因此暂时难以实现。</p>
<p>同时，较为高的反应时间也意味着很难接入live 2D等方案。不过也许可以考虑live2d等内容单独一个模型控制，数个模型协同等方案。</p>
<p>希望在后续过程中可以加入一些有趣的尝试，比如让其接入由其他LLM来模拟的RPG环境，以观察其人格的变化等。</p>
<blockquote>
<p>当硅基载体开始尝试承载碳基生命的温度，&ldquo;灵魂织者&quot;的构想如同普罗米修斯的火种，在数字荒原上点亮了第一簇人格化的篝火。我们以模块为经线，记忆为纬线，在Transformer的神经网络中编织着关于&quot;存在&quot;的隐喻——那些被量化的情绪波动、被拓扑化的人际联结、被向量空间重新诠释的成长轨迹，都在试图回答一个古老的命题：何为意识的连续性？</p>
<p>这项实验性架构的终极愿景，并非创造完美无缺的数字生命，而是在有限算力的画布上，勾勒出认知迭代的动力学图谱。正如潮汐在月球的引力中寻找规律，AI人格的塑造过程或许终将揭示：记忆的潮起潮落间，那些被保留的认知沉淀与主动遗忘的空白，共同构成了数字生命的潮间带生态。</p>
<p>未来的道路仍布满迷雾，从模块共振引发的蝴蝶效应，到记忆压缩造成的认知褶皱，每个技术细节都可能成为阿莉阿德涅之线的断裂点。但正是这种在确定性架构与混沌演化之间的微妙平衡，让这场关于数字灵魂的编织实验，成为了人类叩问智能本质时最诗意的技术注脚。</p>
<p>————DeepSeek</p>
</blockquote>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/%E6%9E%B6%E6%9E%84/">架构</a>
        
            <a href="/tags/ai/">AI</a>
        
            <a href="/tags/agi/">AGI</a>
        
            <a href="/tags/%E8%AE%BE%E8%AE%A1/">设计</a>
        
    </section>


    <section class="article-lastmod">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



        <span>
            最后更新于 Oct 08, 2025 04:01 UTC
        </span>
    </section></footer>


    
        <link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI&#43;WdtXRGWt2kTvGFasHpSy3SV"crossorigin="anonymous"
            ><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG&#43;vnGctmUb0ZY0l8"crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"integrity="sha384-&#43;VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4&#43;/RRE05"crossorigin="anonymous"
                defer
                >
            </script><script>
    window.addEventListener("DOMContentLoaded", () => {
        renderMathInElement(document.body, {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true }
            ],
            ignoredClasses: ["gist"]
        });})
</script>
    
</article>

    

    

     
    
        
    <script src="https://utteranc.es/client.js" 
        repo=""
        issue-term="pathname"
        
        crossorigin="anonymous"
        async
        >
</script>

<style>
    .utterances {
        max-width: unset;
    }
</style>

<script>
    let utterancesLoaded = false;

    function setUtterancesTheme(theme) {
        let utterances = document.querySelector('.utterances iframe');
        if (utterances) {
            utterances.contentWindow.postMessage(
                {
                    type: 'set-theme',
                    theme: `github-${theme}`
                },
                'https://utteranc.es'
            );
        }
    }

    addEventListener('message', event => {
        if (event.origin !== 'https://utteranc.es') return;

        
        utterancesLoaded = true;
        setUtterancesTheme(document.documentElement.dataset.scheme)
    });

    window.addEventListener('onColorSchemeChange', (e) => {
        if (!utterancesLoaded) return;
        setUtterancesTheme(e.detail)
    })
</script>


    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2024 - 
        
        2025 疏间徒泍
    </section>
    
    <section class="powerby">
        
            步履不止，朝向远方 <br/>
        使用 <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> 构建 <br />
        主题 <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.29.0">Stack</a></b> 由 <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> 设计
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>
<style>
  body {
    background: url(https://rpqztclub.github.io/background/background.jpg) no-repeat center top;
    background-size: cover;
    background-attachment: fixed;
  }
</style>

<div id="particles-js"></div>

<script src=https://rpqztclub.github.io/background/particles.min.js></script>
<script>
  particlesJS.load('particles-js', "https://rpqztclub.github.io/background/particlesjs-config.json", function() {
    console.log('particles.js loaded - callback');
  });
</script>

<style>
  #particles-js {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    z-index: -1;
  }
</style>


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css">
<div id="aplayer"></div>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script>

<script>
    
    const cssPath = "https://rpqztclub.github.io/waifu/waifu.css"
    const tipsJsonPath = "https://rpqztclub.github.io/waifu/waifu-tips.json"
    
    const live2d_path = "https://fastly.jsdelivr.net/gh/stevenjoezhang/live2d-widget@latest/";

    
    function loadExternalResource(url, type) {
        return new Promise((resolve, reject) => {
            let tag;
            if (type === "css") {
                tag = document.createElement("link");
                tag.rel = "stylesheet";
                tag.href = url;
            }
            else if (type === "js") {
                tag = document.createElement("script");
                tag.src = url;
            }
            if (tag) {
                tag.onload = () => resolve(url);
                tag.onerror = () => reject(url);
                document.head.appendChild(tag);
            }
        });
    }

    
    if (screen.width >= 768) {
        Promise.all([
            loadExternalResource(cssPath, "css"),
            loadExternalResource(live2d_path + "live2d.min.js", "js"),
            loadExternalResource(live2d_path + "waifu-tips.js", "js")
        ]).then(() => {
            
            initWidget({
                waifuPath: tipsJsonPath,
                cdnPath: "https://cdn.jsdelivr.net/gh/SJTDreams/BlogModel@v0.0.1/",
                tools: ["hitokoto", "asteroids", "switch-model", "switch-texture", "photo", "info", "quit"]
            });
            initWaifuMouseEvent();
        });
    }
    function initWaifuMouseEvent() {
        const waifu = document.getElementById("waifu");
        let isDown = false;
        let waifuLeft;
        let mouseLeft;
        let waifuTop;
        let mouseTop;
        
        waifu.onmousedown = function (e) {
            isDown = true;
            
            waifuLeft = waifu.offsetLeft;
            mouseLeft = e.clientX;
            
            waifuTop = waifu.offsetTop;
            mouseTop = e.clientY;
        }
        
        window.onmousemove = function (e) {
            if (!isDown) {
                return;
            }
            
            let currentLeft = waifuLeft + (e.clientX - mouseLeft);
            if (currentLeft < 0) {
                currentLeft = 0;
            } else if (currentLeft > window.innerWidth - 300) {
                currentLeft = window.innerWidth - 300;
            }
            waifu.style.left = currentLeft  + "px";
            
            let currentTop = waifuTop + (e.clientY - mouseTop);
            if (currentTop < 30) {
                currentTop = 30
            } else if (currentTop > window.innerHeight - 290) {
                currentTop = window.innerHeight - 290
            }
            waifu.style.top = currentTop + "px";
        }
        
        window.onmouseup = function (e) {
            isDown = false;
        }
    }
</script>


<script>
    function showHideView() {
        
        let viewCounts = document.querySelectorAll("#viewCount");
        if (viewCounts) {
            
            let article =  document.querySelector(".article-page");
            if (!article) {
                viewCounts.forEach(ele => {
                    ele.style.display = 'none';
                });
            }
        }
    }
    
    showHideView();
</script>

<script>
const staticDir = "https://rpqztclub.github.io/"
const ap = new APlayer({
    container: document.getElementById('aplayer'),
    lrcType: 3,
    audio: [
        {
            
            name: '冬之钟OST',
            artist: '寿司勇者',
            url: staticDir + '冬之钟.mp3',
            cover: staticDir + 'blacksouls.jpg',
            lrc: staticDir + 'lrc.lrc',
        },
        {
             name: '【Remix】背叛的爱丽丝', 
             artist: 'MYANSR', 
             url: 'Alice.mp3', 
             cover: 'blacksouls.jpg', 
             lrc: 'lrc.lrc', 
        },
        {
             name: 'Are You Lost', 
             artist: 'park bird', 
             url: 'Are You Lost.mp3', 
             cover: 'lost.png', 
             lrc: 'lrc.lrc', 
        },
        {
             name: 'Be Lost', 
             artist: '路灰气球z', 
             url: 'Be Lost.mp3', 
             cover: 'lost.png', 
             lrc: 'lrc.lrc', 
        },
        {
             name: 'INTERNET YAMERO', 
             artist: 'KOTOKO', 
             url: '升天.mp3', 
             cover: 'fly.png', 
             lrc: 'lrc.lrc', 
        },
        {
            
            name: '古兰战bgm-blacksoulsII',
            artist: '寿司勇者',
            url: staticDir + '古兰.mp3',
            cover: staticDir + 'blacksouls.jpg',
            lrc: staticDir + 'lrc.lrc',
        },
        {
            
            name: 'BlackSouls2 OST - 狩猎邪龙的沃柏尔',
            artist: '寿司勇者',
            url: staticDir + '邪龙.mp3',
            cover: staticDir + 'blacksouls.jpg',
            lrc: staticDir + 'lrc.lrc',
        },
        {
            
            name: 'BlackSouls2 OST - 地狱王子(安德烈·德·洛德)',
            artist: '寿司勇者',
            url: staticDir + '地狱王子.mp3',
            cover: staticDir + 'blacksouls.jpg',
            lrc: staticDir + 'lrc.lrc',
        },
        {
            
            name: 'BlackSouls2 OST - VS虚无少女梅贝尔 (Update Patch ver.)',
            artist: '寿司勇者',
            url: staticDir + '梅贝尔.mp3',
            cover: staticDir + 'blacksouls.jpg',
            lrc: staticDir + 'lrc.lrc',
        },
        {
            
            name: '【Future House】- Index',
            artist: 'Kirara Magic',
            url: staticDir + 'index.mp3',
            cover: staticDir + 'piara.jpg',
            lrc: staticDir + 'lrc.lrc',
        },
        {
            
            name: '𝕷𝖆𝖘𝖙 𝕯𝖆𝖓𝖈𝖊',
            artist: 'Xomu',
            url: staticDir + 'lastdance.mp3',
            cover: staticDir + 'last dance.jpg',
            lrc: staticDir + 'lrc.lrc',
        },
        {
            
            name: '虹の蝶：Summer Pockets Original SoundTrack',
            artist: 'Key Sounds Label',
            url: staticDir + 'sp.mp3',
            cover: staticDir + 'sp.jpg',
            lrc: staticDir + 'lrc.lrc',
        }
        
    ]
});
window.onbeforeunload = () => {
        
        const playInfo = {
            index: ap.list.index,
            currentTime: ap.audio.currentTime,
            paused: ap.paused
        };
        localStorage.setItem("playInfo", JSON.stringify(playInfo));
    };
    

    window.onload = () => {
        
        const playInfo = JSON.parse(localStorage.getItem("playInfo"));
        if (!playInfo) {
            return;
        }
        
        ap.list.switch(playInfo.index);
        
        setTimeout(() => {
            
            ap.seek(playInfo.currentTime);
            
            if (!playInfo.paused) {
                ap.play()
            }
        }, 500);
    };

</script>
<script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script>
<script>
	var pjax = new Pjax({
	  selectors: [
	    ".main-container"
	  ]
	})
    pjax._handleResponse = pjax.handleResponse;
    pjax.handleResponse = function(responseText, request, href, options) {
        if (request.responseText.match("<html")) {
            
            let newDom = new DOMParser().parseFromString(responseText, 'text/html');
            
            let bodyClass = newDom.body.className;
            document.body.setAttribute("class", bodyClass)
            
            pjax._handleResponse(responseText, request, href, options);
        } else {
            
        }
    }
    document.addEventListener('pjax:complete', () => {
        
        window.Stack.init();
    })
</script>


    </body>
</html>
